# ⚠️ Notion 페이지 작성 에러 처리 가이드 (범용)

> 💡 **범용 가이드**: 모든 MCP 지원 AI 플랫폼에서 사용 가능

## 📋 TL;DR (핵심 요약)

**목적**: 에러 발생 시 표준화된 대응 절차 제공

**핵심 규칙**:

1. 모든 에러는 즉시 사용자에게 보고
2. 에러 코드, 원인, 해결 단계 명시
3. 재시도 전 사용자에게 확인 요청
4. 기존 페이지 내용은 절대 삭제하지 않음

---

## 🚨 에러 보고 표준 형식

### 표준 에러 보고 형식

```markdown
🚨 **에러 발생**

**에러 코드**: [ERR_XXX]
**에러 메시지**: [상세 에러 메시지]
**발생 단계**: [단계 번호 및 설명]
**발생 시각**: [타임스탬프]

**원인**:

- [원인 1]
- [원인 2]

**해결 방법**:

1. [해결 단계 1]
2. [해결 단계 2]
3. [해결 단계 3]

**사용자 확인 사항**:

- [ ] [확인 항목 1]
- [ ] [확인 항목 2]

다시 시도하시겠습니까?
```

---

## 📚 공통 에러 목록

### ERR_FILE_NOT_FOUND

**에러**: 파일을 찾을 수 없음

**원인**:

- 잘못된 파일 경로
- 파일이 이동/삭제됨
- 워크스페이스 외부 파일

**해결**:

1. 파일 경로 확인
2. 파일 존재 여부 확인
3. 상대 경로 vs 절대 경로 확인

**예시 보고**:

```markdown
🚨 **에러 발생**

**에러 코드**: ERR_FILE_NOT_FOUND
**에러 메시지**: 파일을 찾을 수 없습니다: `노션_가이드.md`
**발생 단계**: 1. 파일 읽기

**원인**:

- 파일 경로가 잘못되었거나 파일이 존재하지 않습니다.

**해결 방법**:

1. 파일 경로를 확인해주세요
2. 파일이 워크스페이스 내에 있는지 확인해주세요
3. 절대 경로 또는 상대 경로를 정확하게 입력해주세요

**올바른 예시**:

- 절대 경로: `E:\hanghae99\my\Notion_Agent\노션_가이드.md`
- 상대 경로: `./노션_가이드.md`
- 파일명만: `노션_가이드.md` (워크스페이스 전체 검색 필요)

다시 시도하시겠습니까?
```

---

### ERR_API_MOVE_FAILED

**에러**: Notion API로 페이지 이동 실패

**원인**:

- API 권한 부족
- 부모 페이지가 데이터베이스
- 부모 페이지에 쓰기 권한 없음

**🚨 중요**: 이 에러가 발생하면 **절대 전역에 생성된 페이지를 사용하지 마세요**!

**해결 (자동 진행)**:

1. ⚠️ **즉시 브라우저 자동화로 전환** (옵션 C) - 사용자 확인 불필요
2. 전역에 생성된 페이지 무시 (사용자가 나중에 정리)
3. 부모 페이지에 직접 접속하여 하위 페이지 생성
4. 내용 업로드까지 완료

**예시 보고**:

```markdown
🚨 **API 이동 실패 감지**

**에러 코드**: ERR_API_MOVE_FAILED
**에러 메시지**: Notion API로 페이지 이동에 실패했습니다.
**발생 단계**: 2. 페이지 생성 (API 이동)

**원인**:

- 부모 페이지에 대한 쓰기 권한이 없거나
- 부모 페이지가 데이터베이스이거나
- API 제한으로 이동할 수 없습니다.

**🔄 자동 복구 중**:

✅ **브라우저 자동화(PlayWright) 방식으로 자동 전환합니다**

1. 전역에 생성된 페이지는 무시합니다 (나중에 정리 가능)
2. 부모 페이지에 직접 접속합니다
3. 하위 페이지를 생성합니다 (UI 버튼 또는 `Ctrl+Shift+P` 사용)
4. 제목을 입력합니다
5. 내용을 업로드합니다

**다음 단계**:

- [ ] 부모 페이지 URL로 접속 중...
- [ ] 로그인 상태 확인
- [ ] 하위 페이지 생성 (UI 버튼 또는 키보드 단축키)
- [ ] 제목 입력
- [ ] 내용 업로드

잠시만 기다려주세요...
```

**중요**: 
- 이 에러는 **사용자 확인 없이 자동으로 fallback**해야 합니다. 
- 사용자가 부모 페이지를 지정했으므로 반드시 그 위치에 생성해야 합니다.
- ⚠️ **하위 페이지 생성 시 `/page` 명령어 대신 UI 버튼 또는 `Ctrl+Shift+P` 사용** (더 안정적)

---

### ERR_PAGE_CREATION_FAILED

**에러**: 하위 페이지 생성 실패

**원인**:

- 페이지 생성 명령이 실행되지 않음
- 권한 부족으로 페이지 생성 차단
- 대화상자(dialog) 발생으로 인한 차단
- Notion UI 변경으로 방법이 작동하지 않음

**증상**:

- `/page` 텍스트가 그대로 남아있음 (가장 명확한 실패 신호)
- URL이 변경되지 않음
- 제목 영역(`h1[contenteditable="true"]`)이 없음
- 대화상자가 열림

**해결**:

1. **즉시 중단** - 페이지 생성 없이 다음 단계로 진행하지 않음
2. 에러 보고
3. 사용자에게 권한 확인 또는 수동 생성 요청

**예시 보고**:

```markdown
🚨 **에러 발생: 하위 페이지 생성 실패**

**에러 코드**: ERR_PAGE_CREATION_FAILED
**에러 메시지**: 하위 페이지 생성에 실패했습니다.
**발생 단계**: 2. 페이지 생성 (브라우저 하위 페이지 생성)
**부모 페이지 URL**: [부모 페이지 URL]

**원인**:

- 페이지 생성 명령이 실행되지 않았습니다
- 다음 실패 신호가 감지되었습니다:
  - ❌ `/page` 텍스트가 그대로 남아있음
  - ❌ 제목 영역이 생성되지 않음
  - ❌ URL이 변경되지 않음

**가능한 원인**:

1. 편집 권한이 부족할 수 있습니다
2. Notion UI가 변경되어 방법이 작동하지 않을 수 있습니다
3. 대화상자 또는 팝업이 차단했을 수 있습니다

**해결 방법**:

**방법 1**: 수동으로 하위 페이지 생성

1. 부모 페이지에서 직접 하위 페이지를 수동으로 생성해주세요
2. 생성된 페이지 URL을 알려주시면 내용만 업로드하겠습니다

**방법 2**: 워크스페이스 루트에 생성

1. 부모 페이지 지정 없이 워크스페이스 루트에 생성하겠습니다
2. 나중에 직접 원하는 위치로 이동할 수 있습니다

**방법 3**: 편집 권한 확인

1. 부모 페이지의 편집 권한을 확인해주세요
2. 권한이 있다면 다시 시도하겠습니다

어떤 방법을 선택하시겠습니까?
```

**중요**: 이 에러가 발생하면 **절대 계속 진행하지 마세요**. 페이지가 생성되지 않은 상태에서 제목이나 내용을 입력하려고 하면 의미 없는 작업이 됩니다.

---

### ERR_BROWSER_LOGIN_REQUIRED

**에러**: Notion 로그인 필요

**원인**:

- 브라우저 세션 만료
- 로그아웃 상태

**해결**:

1. 사용자에게 로그인 요청
2. 로그인 완료 대기
3. 재시도

**예시 보고**:

```markdown
🚨 **에러 발생**

**에러 코드**: ERR_BROWSER_LOGIN_REQUIRED
**에러 메시지**: Notion에 로그인이 필요합니다.
**발생 단계**: 2. 페이지 생성 (브라우저 접속)

**원인**:

- 브라우저가 로그아웃 상태입니다.

**해결 방법**:

1. 브라우저에서 Notion에 로그인해주세요
2. 로그인 완료 후 "완료"라고 답변해주세요

로그인이 완료되었습니까?
```

---

### ERR_GOOGLE_OAUTH_BLOCKED

**에러**: Google OAuth 로그인 차단

**증상**:

- "로그인할 수 없음" 메시지
- "브라우저 또는 앱이 안전하지 않을 수 있습니다"
- Google 로그인 페이지에서 차단

**원인**:

- Playwright 자동화 감지 (`navigator.webdriver = true`)
- 깨끗한 브라우저 프로필 (쿠키, 캐시 없음)
- Google의 자동화 방지 정책

**해결**:

**방법 1 (권장)**: Chrome 기본 프로필 사용

1. Chrome을 완전히 종료
2. MCP 서버 설정에 프로필 경로 추가
3. Agent 재시작

**방법 2**: 전용 프로필 생성 및 사전 로그인

1. `chrome_profile/` 폴더 생성
2. 첫 실행 시 수동 로그인
3. 이후 자동으로 로그인 상태 유지

**방법 3**: 수동 로그인

1. 브라우저가 열리면 직접 로그인
2. 로그인 완료 후 "완료" 입력

**자세한 가이드**: `05_브라우저_프로필_설정.md` 참조

**예시 보고**:

```markdown
🚨 **에러 발생**

**에러 코드**: ERR_GOOGLE_OAUTH_BLOCKED
**에러 메시지**: Google OAuth 로그인 차단 - 브라우저가 안전하지 않음
**발생 단계**: 2. 페이지 생성 (Notion 로그인)

**원인**:

- Google이 자동화 브라우저를 감지하여 로그인 차단

**해결 방법**:

**방법 1 (권장)**: Chrome 기본 프로필 사용

1. Chrome을 완전히 종료해주세요
2. Agent를 다시 시작하면 기본 프로필로 실행됩니다
3. 이미 로그인된 상태로 시작됩니다

**방법 2**: 지금 수동 로그인

1. 열린 브라우저에서 직접 로그인해주세요
2. 로그인 완료 후 "완료"라고 입력해주세요

어떤 방법을 사용하시겠습니까?
```

---

### ERR_BROWSER_NO_EDIT_PERMISSION

**에러**: 페이지 편집 권한 없음

**원인**:

- 읽기 전용 페이지
- **공유 페이지로 편집 권한 제한** (가장 흔한 원인)
- 워크스페이스 권한 부족
- 게스트 사용자로 접근

**증상**:

- `[contenteditable="true"]` 영역이 없음
- "하위 페이지 추가" 버튼이 보이지 않음 또는 클릭 차단
- `/page` 명령어가 작동하지 않음
- JavaScript로 버튼 클릭 시도 시 버튼을 찾을 수 없음

**해결**:

1. **페이지 권한 확인 및 요청** (권장)
2. 다른 부모 페이지 선택
3. 워크스페이스 루트에 생성

**예시 보고**:

```markdown
🚨 **에러 발생: 편집 권한 없음**

**에러 코드**: ERR_BROWSER_NO_EDIT_PERMISSION
**에러 메시지**: 페이지 편집 권한이 없습니다.
**발생 단계**: 2. 페이지 생성 (브라우저 편집 권한 확인)
**페이지 URL**: [부모 페이지 URL]

**원인**:

- 이 페이지는 **공유 페이지**로 편집 권한이 제한되어 있습니다
- 하위 페이지를 생성할 수 있는 권한이 없습니다

**확인된 제한 사항**:

- ❌ 편집 가능 영역 없음 (`contenteditable="true"` 없음)
- ❌ "하위 페이지 추가" 버튼 없음
- ❌ `/page` 명령어 작동 안 함

**해결 방법**:

**방법 1 (권장)**: 페이지 소유자에게 편집 권한 요청

1. 페이지 소유자에게 연락하여 **편집 권한** 또는 **관리자 권한**을 요청해주세요
2. 권한을 받은 후 "다시 시도"라고 입력해주세요

**방법 2**: 다른 부모 페이지 선택

1. 편집 권한이 있는 다른 페이지 URL을 알려주세요
2. 해당 페이지 하위에 생성하겠습니다

**방법 3**: 워크스페이스 루트에 생성

1. 부모 페이지 없이 워크스페이스 루트에 생성하겠습니다
2. 나중에 직접 원하는 위치로 이동할 수 있습니다

어떤 방법을 선택하시겠습니까?
```

**중요**: 이 에러는 사용자가 해결해야 하는 문제입니다. 강제로 우회하려고 하지 마세요.

---

### ERR_CLIPBOARD_FAILED

**에러**: 클립보드 복사 실패

**원인**:

- 브라우저 권한 부족
- 텍스트 크기 초과 (2,000자)
- 특수 문자 문제

**해결**:

1. 청크 크기 줄이기
2. 특수 문자 이스케이프
3. 재시도 (최대 3회)

**예시 보고**:

```markdown
🚨 **에러 발생**

**에러 코드**: ERR_CLIPBOARD_FAILED
**에러 메시지**: 클립보드 복사에 실패했습니다.
**발생 단계**: 4. 내용 업로드 (청크 [X]/[Y])

**원인**:

- 브라우저 권한 부족 또는
- 텍스트가 너무 큽니다 (현재: [크기]자, 최대: 2,000자)

**해결 방법**:

1. 청크 크기를 줄여서 재시도합니다
2. 재시도 [1/3]

진행 중...
```

---

### ERR_CONTENT_VERIFICATION_FAILED

**에러**: 내용 검증 실패

**원인**:

- 일부 청크가 업로드되지 않음
- 네트워크 지연
- Notion 서버 오류

**해결**:

1. 페이지 내용 확인
2. 누락된 청크 재업로드
3. 전체 재시도 제안

**예시 보고**:

```markdown
🚨 **에러 발생**

**에러 코드**: ERR_CONTENT_VERIFICATION_FAILED
**에러 메시지**: 업로드된 내용 검증에 실패했습니다.
**발생 단계**: 5. 최종 검증

**원인**:

- 파일의 마지막 줄 텍스트가 페이지에서 발견되지 않았습니다.
- 일부 청크가 업로드되지 않았을 수 있습니다.

**해결 방법**:

1. 페이지 URL: [페이지 URL]
2. 직접 페이지에 접속하여 내용을 확인해주세요
3. 누락된 부분이 있다면 재시도하겠습니다

**검증 정보**:

- 찾고자 한 텍스트: `[마지막 줄 텍스트]`
- 페이지 텍스트 길이: [길이]자

페이지를 확인하셨습니까? 재시도하시겠습니까?
```

---

## 🔁 재시도 전략

### 재시도 체크리스트

**재시도 전 확인**:

- [ ] 에러 원인 파악 완료
- [ ] 사용자에게 에러 보고 완료
- [ ] 사용자가 재시도 승인
- [ ] 재시도 횟수 카운트 (최대 3회)

**재시도 대기 시간**:

- 1회: 즉시
- 2회: 2초 대기
- 3회: 5초 대기

### 재시도 코드 패턴

```javascript
async function retryWithBackoff(fn, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (err) {
      if (i === maxRetries - 1) {
        throw err; // 마지막 재시도 실패 시 에러 전파
      }

      // 지수 백오프
      const delay = Math.pow(2, i) * 1000;
      await new Promise((resolve) => setTimeout(resolve, delay));
    }
  }
}
```

---

## 🛡️ 안전 규칙

### 절대 금지 사항

1. ❌ **기존 페이지 내용 삭제**
2. ❌ **사용자 확인 없이 재시도**
3. ❌ **에러 은폐 또는 무시**
4. ❌ **불완전한 업로드 상태로 완료 보고**

### 필수 수행 사항

1. ✅ **모든 에러 즉시 보고**
2. ✅ **에러 발생 시 현재 상태 보존**
3. ✅ **사용자에게 명확한 해결 방법 제시**
4. ✅ **재시도 전 사용자 승인 획득**

---

## 📋 에러 처리 체크리스트

**에러 발생 시**:

- [ ] 에러 코드 확인
- [ ] 에러 메시지 추출
- [ ] 발생 단계 기록
- [ ] 원인 분석
- [ ] 표준 형식으로 사용자에게 보고
- [ ] 해결 방법 제시
- [ ] 사용자 응답 대기
- [ ] 재시도 또는 대체 방법 진행

---

## 📚 참조

- **메인 가이드**: `00_메인_가이드.md`
- **실행 가이드**: `01_실행_가이드.md`
- **코드 패턴**: `02_코드_패턴.md`
- **템플릿**: `04_템플릿.md`

---

**Made with ❤️ for AI Agents (Universal)**

---

## 📝 출처

**작성자**: 김준모  
**이메일**: rnsdlsdmtlk@gmail.com  
**버전**: 2.0.0 (Universal)
